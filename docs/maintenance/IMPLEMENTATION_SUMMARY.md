# åŠ¨æ€ç»´æŠ¤æ¨¡å—å®ç°æ€»ç»“

## ğŸ“¦ æ¨¡å—æ¦‚è§ˆ

åŠ¨æ€ç»´æŠ¤æ¨¡å—å®ç°äº†**åŸºäºGitæäº¤çš„æµ‹è¯•ç”¨ä¾‹è‡ªåŠ¨ç»´æŠ¤**åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- âœ… å®æ—¶ç›‘æ§Gitæäº¤å˜æ›´
- âœ… è‡ªåŠ¨è¯†åˆ«å—å½±å“çš„æµ‹è¯•ç”¨ä¾‹
- âœ… å±•ç¤ºä»£ç å·®å¼‚
- âœ… ç”¨æˆ·å†³ç­–äº¤äº’ï¼ˆåŠŸèƒ½å˜æ›´ vs é‡æ„ï¼‰
- âœ… æ‰¹é‡ä¿®å¤æµ‹è¯•ç”¨ä¾‹

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ¨¡å—åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Extension Integration           â”‚
â”‚  (extension.ts - æ³¨å†Œå‘½ä»¤å’Œè§†å›¾)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            UI Layer                      â”‚
â”‚  - TreeProvider: æ ‘å½¢è§†å›¾                â”‚
â”‚  - DiffViewer: å·®å¼‚å±•ç¤º                 â”‚
â”‚  - DecisionDialog: ç”¨æˆ·å†³ç­–             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Command Layer                   â”‚
â”‚  - AnalyzeMaintenance: åˆ†ææµç¨‹         â”‚
â”‚  - BatchFix: ä¿®å¤æµç¨‹                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Git Layer                     â”‚
â”‚  - CommitWatcher: æäº¤ç›‘æ§              â”‚
â”‚  - DiffAnalyzer: å·®å¼‚åˆ†æ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          API Layer                      â”‚
â”‚  - MaintenanceClient: åç«¯é€šä¿¡          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Backend API                      â”‚
â”‚  https://cs5351.efan.dev/api/v1         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ æ ¸å¿ƒç»„ä»¶

### 1. Gitæäº¤ç›‘æ§å™¨ (`git/commitWatcher.ts`)

**èŒè´£**ï¼šç›‘æ§Gitä»“åº“çš„æ–°æäº¤

**å…³é”®æ–¹æ³•**ï¼š
- `startWatching()` - å¼€å§‹ç›‘æ§ï¼ˆè½®è¯¢æˆ–æ–‡ä»¶ç›‘å¬ï¼‰
- `getCurrentCommitHash()` - è·å–å½“å‰æäº¤
- `getPreviousCommitHash()` - è·å–ä¸Šä¸€ä¸ªæäº¤
- `compareCommits()` - æ¯”è¾ƒä¸¤ä¸ªæäº¤

**ç›‘æ§æ–¹å¼**ï¼š
- **è½®è¯¢æ¨¡å¼**ï¼ˆé»˜è®¤ï¼‰ï¼šæ¯5ç§’æ£€æŸ¥ `git rev-parse HEAD`
- **æ–‡ä»¶ç›‘å¬**ï¼šç›‘å¬ `.git/HEAD` æ–‡ä»¶å˜åŒ–

### 2. å·®å¼‚åˆ†æå™¨ (`git/diffAnalyzer.ts`)

**èŒè´£**ï¼šåˆ†æä¸¤æ¬¡æäº¤ä¹‹é—´çš„ä»£ç å·®å¼‚

**å…³é”®æ–¹æ³•**ï¼š
- `analyzeCommitDiff()` - åˆ†ææäº¤å·®å¼‚
- `getCodeDiff()` - è·å–ç»Ÿä¸€diffæ ¼å¼
- `generateChangeSummary()` - ç”Ÿæˆå˜æ›´æ‘˜è¦

**åˆ†æå†…å®¹**ï¼š
- è¯†åˆ«å˜æ›´çš„Pythonæ–‡ä»¶
- æå–å˜æ›´çš„å‡½æ•°å
- è®¡ç®—å¢åˆ è¡Œæ•°
- åˆ¤æ–­å˜æ›´ç±»å‹

### 3. åç«¯APIå®¢æˆ·ç«¯ (`api/maintenanceClient.ts`)

**èŒè´£**ï¼šä¸åç«¯APIé€šä¿¡

**å…³é”®æ–¹æ³•**ï¼š
- `checkHealth()` - å¥åº·æ£€æŸ¥
- `analyzeMaintenance()` - åˆ†æç»´æŠ¤
- `batchFixTests()` - æ‰¹é‡ä¿®å¤
- `getCodeDiff()` - è·å–ä»£ç å·®å¼‚

**é…ç½®è¯»å–**ï¼š
```typescript
// ä¼˜å…ˆçº§ï¼šmaintenance.backendUrl > backendUrl > é»˜è®¤å€¼
config.get('maintenance.backendUrl') || 
config.get('backendUrl', 'https://llt-assistant.fly.dev/api/v1')
```

### 4. åˆ†æå‘½ä»¤ (`commands/analyzeMaintenance.ts`)

**æ‰§è¡Œæµç¨‹**ï¼ˆ8æ­¥ï¼‰ï¼š

```
1. æ£€æŸ¥åç«¯å¥åº· (10%)
   â†“
2. è·å–æäº¤ä¿¡æ¯ (20%)
   â†“
3. åˆ†æä»£ç å·®å¼‚ (30%)
   â†“
4. å‡†å¤‡APIè¯·æ±‚ (40%)
   â†“
5. è°ƒç”¨åç«¯åˆ†æ (50%)
   â†“
6. æ„å»ºåˆ†æç»“æœ (80%)
   â†“
7. æ›´æ–°UIæ˜¾ç¤º (100%)
   â†“
8. å±•ç¤ºå·®å¼‚å¹¶è¯¢é—®å†³ç­–
```

### 5. æ‰¹é‡ä¿®å¤å‘½ä»¤ (`commands/batchFix.ts`)

**ä¸¤ç§ä¿®å¤æ¨¡å¼**ï¼š

#### æ¨¡å¼Aï¼šåŠŸèƒ½å˜æ›´ â†’ é‡æ–°ç”Ÿæˆæµ‹è¯•

```typescript
regenerateTests() {
  for each test:
    1. æ‰¾åˆ°æºæ–‡ä»¶å’Œå‡½æ•°
    2. ASTåˆ†æå‡½æ•°
    3. è°ƒç”¨æµ‹è¯•ç”ŸæˆAPI
    4. æ’å…¥æ–°æµ‹è¯•ä»£ç 
}
```

#### æ¨¡å¼Bï¼šä»…é‡æ„ â†’ æå‡è¦†ç›–ç‡

```typescript
improveCoverage() {
  1. æ„å»ºæ‰¹é‡ä¿®å¤è¯·æ±‚
  2. è°ƒç”¨åç«¯API
  3. å¤„ç†è¿”å›ç»“æœ
}
```

### 6. å†³ç­–å¯¹è¯æ¡† (`ui/decisionDialog.ts`)

**äº¤äº’æµç¨‹**ï¼š

```
å±•ç¤ºå˜æ›´æ‘˜è¦
    â†“
è¯¢é—®ï¼š"åŠŸèƒ½æ˜¯å¦å‘ç”Ÿå˜æ›´ï¼Ÿ"
    â†“
[æ˜¯] â†’ è¾“å…¥æè¿° â†’ é€‰æ‹©æµ‹è¯• â†’ è¿”å› {decision: 'functionality_changed', ...}
    â†“
[å¦] â†’ é€‰æ‹©æµ‹è¯• â†’ è¿”å› {decision: 'refactor_only', ...}
    â†“
[å–æ¶ˆ] â†’ è¿”å› {decision: 'cancelled'}
```

### 7. æ ‘å½¢è§†å›¾ (`ui/maintenanceTreeProvider.ts`)

**æ˜¾ç¤ºç»“æ„**ï¼š
```
ğŸ“Š Summary
  â”œâ”€ ğŸ“ X files changed
  â”œâ”€ ğŸ§ª Y tests affected
  â””â”€ ğŸ“ +A / -B lines
ğŸ“„ test_file1.py
  â”œâ”€ ğŸ”´ test_case1 [CRITICAL]
  â””â”€ ğŸŸ¡ test_case2 [MEDIUM]
```

---

## ğŸ“¡ åç«¯æ¥å£å¯¹æ¥

### æ¥å£é…ç½®

**é…ç½®ä½ç½®**ï¼š`.vscode/settings.json` æˆ– VSCodeè®¾ç½®

```json
{
  "llt-assistant.maintenance.backendUrl": "https://cs5351.efan.dev/api/v1"
}
```

### å¿…éœ€æ¥å£

#### 1. GET /health
```json
{"status": "ok"}
```

#### 2. POST /maintenance/analyze
**è¯·æ±‚**ï¼š
```json
{
  "commit_hash": "abc123",
  "previous_commit_hash": "def456",
  "changes": [{
    "file_path": "src/example.py",
    "old_content": "...",
    "new_content": "...",
    "changed_functions": ["add"],
    "lines_added": 2,
    "lines_removed": 1
  }]
}
```

**å“åº”**ï¼š
```json
{
  "context_id": "ctx-123",
  "affected_tests": [{
    "test_file": "tests/test_example.py",
    "test_name": "test_add",
    "impact_level": "high",
    "reason": "Function behavior changed",
    "requires_update": true
  }],
  "change_summary": {...}
}
```

#### 3. POST /maintenance/batch-fix
**è¯·æ±‚**ï¼š
```json
{
  "action": "regenerate" | "improve_coverage",
  "tests": [...],
  "user_description": "..." // ä»…å½“actionä¸ºregenerateæ—¶
}
```

---

## ğŸ¯ å…³é”®å®ç°ç»†èŠ‚

### 1. Gitæ“ä½œ

**ä½¿ç”¨ `execSync` æ‰§è¡ŒGitå‘½ä»¤**ï¼š
- `git rev-parse HEAD` - è·å–å½“å‰æäº¤
- `git diff --name-only HEAD~1 HEAD` - è·å–å˜æ›´æ–‡ä»¶åˆ—è¡¨
- `git show HEAD~1:file.py` - è·å–æ—§æ–‡ä»¶å†…å®¹
- `git show HEAD:file.py` - è·å–æ–°æ–‡ä»¶å†…å®¹

**é”™è¯¯å¤„ç†**ï¼š
- æ£€æŸ¥æ˜¯å¦ä¸ºGitä»“åº“
- å¤„ç†æ–‡ä»¶ä¸å­˜åœ¨çš„æƒ…å†µ
- å¤„ç†æ— æäº¤å†å²çš„æƒ…å†µ

### 2. è¿›åº¦åé¦ˆ

**ä½¿ç”¨ `vscode.window.withProgress`**ï¼š
- æ˜¾ç¤ºè¿›åº¦é€šçŸ¥
- 8ä¸ªé˜¶æ®µçš„è¿›åº¦æ›´æ–°
- ä¸å¯å–æ¶ˆï¼ˆé¿å…çŠ¶æ€ä¸ä¸€è‡´ï¼‰

### 3. ç”¨æˆ·äº¤äº’

**ä¸‰å±‚äº¤äº’**ï¼š
1. **ä¸»å†³ç­–**ï¼šåŠŸèƒ½æ˜¯å¦å˜æ›´ï¼Ÿï¼ˆæ¨¡æ€å¯¹è¯æ¡†ï¼‰
2. **æè¿°è¾“å…¥**ï¼šæ–°åŠŸèƒ½æè¿°ï¼ˆè¾“å…¥æ¡†ï¼‰
3. **æµ‹è¯•é€‰æ‹©**ï¼šé€‰æ‹©è¦ä¿®å¤çš„æµ‹è¯•ï¼ˆå¤šé€‰å¿«é€Ÿé€‰æ‹©ï¼‰

### 4. æ•°æ®æŒä¹…åŒ–

**çŠ¶æ€å­˜å‚¨**ï¼š
- `MaintenanceTreeProvider.data` - å­˜å‚¨åˆ†æç»“æœ
- é€šè¿‡ `getAnalysisResult()` è·å–ï¼Œä¾›æ‰¹é‡ä¿®å¤ä½¿ç”¨

---

## ğŸ”„ å®Œæ•´æ•°æ®æµ

```
ç”¨æˆ·è§¦å‘
    â†“
Gitæ“ä½œ (è·å–æäº¤ä¿¡æ¯)
    â†“
å·®å¼‚åˆ†æ (æå–ä»£ç å˜æ›´)
    â†“
æ„å»ºAPIè¯·æ±‚
    â†“
åç«¯API (è¯†åˆ«å—å½±å“æµ‹è¯•)
    â†“
æ„å»ºåˆ†æç»“æœ
    â†“
æ›´æ–°UI (æ ‘å½¢è§†å›¾)
    â†“
å±•ç¤ºå·®å¼‚ (diffè§†å›¾)
    â†“
ç”¨æˆ·å†³ç­–
    â†“
æ‰¹é‡ä¿®å¤ (æ ¹æ®å†³ç­–æ‰§è¡Œ)
```

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

### æ–‡ä»¶æ•°é‡
- **TypeScriptæ–‡ä»¶**ï¼š13ä¸ª
- **ç±»å‹å®šä¹‰æ–‡ä»¶**ï¼š2ä¸ª
- **å‘½ä»¤æ–‡ä»¶**ï¼š2ä¸ª
- **UIç»„ä»¶**ï¼š3ä¸ª
- **Gitå·¥å…·**ï¼š2ä¸ª
- **APIå®¢æˆ·ç«¯**ï¼š1ä¸ª

### ä»£ç è¡Œæ•°
- **æ€»ä»£ç è¡Œæ•°**ï¼šçº¦ 2,500+ è¡Œ
- **ç±»å‹å®šä¹‰**ï¼šçº¦ 200 è¡Œ
- **æ ¸å¿ƒé€»è¾‘**ï¼šçº¦ 1,500 è¡Œ
- **UIç»„ä»¶**ï¼šçº¦ 800 è¡Œ

---

## âœ… åŠŸèƒ½å®Œæ•´æ€§

### å·²å®ç°åŠŸèƒ½

- âœ… Gitæäº¤ç›‘æ§ï¼ˆè½®è¯¢æ¨¡å¼ï¼‰
- âœ… ä»£ç å·®å¼‚åˆ†æ
- âœ… åç«¯APIå¯¹æ¥
- âœ… æ ‘å½¢è§†å›¾æ˜¾ç¤º
- âœ… å·®å¼‚æŸ¥çœ‹å™¨
- âœ… ç”¨æˆ·å†³ç­–å¯¹è¯æ¡†
- âœ… æ‰¹é‡ä¿®å¤ï¼ˆä¸¤ç§æ¨¡å¼ï¼‰
- âœ… è¿›åº¦åé¦ˆ
- âœ… é”™è¯¯å¤„ç†
- âœ… é…ç½®ç®¡ç†

### å¾…ä¼˜åŒ–åŠŸèƒ½

- â³ Git Hooké›†æˆï¼ˆéœ€è¦åç«¯æ”¯æŒï¼‰
- â³ æ›´æ™ºèƒ½çš„æµ‹è¯•åŒ¹é…ç®—æ³•
- â³ æ‰¹é‡æ“ä½œçš„é¢„è§ˆåŠŸèƒ½
- â³ å†å²åˆ†æè®°å½•

---

## ğŸ“ è®¾è®¡æ¨¡å¼

### ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼

1. **å‘½ä»¤æ¨¡å¼**ï¼š`AnalyzeMaintenanceCommand`, `BatchFixCommand`
2. **æä¾›è€…æ¨¡å¼**ï¼š`MaintenanceTreeProvider` (TreeDataProvider)
3. **ç­–ç•¥æ¨¡å¼**ï¼šä¸¤ç§ä¿®å¤ç­–ç•¥ï¼ˆé‡æ–°ç”Ÿæˆ vs æå‡è¦†ç›–ç‡ï¼‰
4. **è§‚å¯Ÿè€…æ¨¡å¼**ï¼šGitæäº¤ç›‘æ§çš„å›è°ƒæœºåˆ¶

---

## ğŸ”— ä¸ç°æœ‰æ¨¡å—çš„é›†æˆ

### å¤ç”¨ç°æœ‰ç»„ä»¶

1. **æµ‹è¯•ç”Ÿæˆ**ï¼š`BackendAgentController` - ç”¨äºé‡æ–°ç”Ÿæˆæµ‹è¯•
2. **ASTåˆ†æ**ï¼š`PythonASTAnalyzer` - ç”¨äºåˆ†ææºå‡½æ•°
3. **ä»£ç æ’å…¥**ï¼š`TestGenerationController` - ç”¨äºæ’å…¥æ–°æµ‹è¯•
4. **é…ç½®ç®¡ç†**ï¼š`ConfigurationManager` - ç”¨äºè·å–åç«¯URL

### æ–°å¢ç»„ä»¶

1. **Gitç›‘æ§**ï¼š`GitCommitWatcher` - æ–°å¢
2. **å·®å¼‚åˆ†æ**ï¼š`GitDiffAnalyzer` - æ–°å¢
3. **ç»´æŠ¤APIå®¢æˆ·ç«¯**ï¼š`MaintenanceBackendClient` - æ–°å¢
4. **ç»´æŠ¤UIç»„ä»¶**ï¼š`MaintenanceTreeProvider` ç­‰ - æ–°å¢

---

## ğŸ“ æ€»ç»“

åŠ¨æ€ç»´æŠ¤æ¨¡å—æ˜¯ä¸€ä¸ª**å®Œæ•´çš„ã€ç”Ÿäº§å°±ç»ªçš„åŠŸèƒ½æ¨¡å—**ï¼Œå®ç°äº†ï¼š

1. **è‡ªåŠ¨åŒ–**ï¼šè‡ªåŠ¨æ£€æµ‹ä»£ç å˜æ›´
2. **æ™ºèƒ½åŒ–**ï¼šåç«¯AIè¯†åˆ«å—å½±å“æµ‹è¯•
3. **å¯è§†åŒ–**ï¼šæ¸…æ™°çš„UIå±•ç¤º
4. **å¯æ“ä½œ**ï¼šä¸€é”®æ‰¹é‡ä¿®å¤

**æ ¸å¿ƒä»·å€¼**ï¼šå¸®åŠ©å¼€å‘è€…å¿«é€Ÿç»´æŠ¤å› ä»£ç å˜æ›´è€Œå¤±æ•ˆçš„æµ‹è¯•ç”¨ä¾‹ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚

---

è¯¦ç»†ä»£ç è§£æè¯·æŸ¥çœ‹ï¼š[ä»£ç è§£ææ–‡æ¡£](./CODE_ANALYSIS.md)

